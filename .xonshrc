import subprocess
import pathlib
import sys
import os
import platform

def get_home()->pathlib.Path:
    home = os.environ.get('HOME')
    if home:
        return pathlib.Path(home)
    return pathlib.Path(os.environ['USERPROFILE'])

HOME_DIR = get_home()
sys.path.append(str((HOME_DIR / 'dotfiles').absolute()))
import xonsh_py

$VI_MODE = False
$XONSH_COLOR_STYLE = 'native'
$XONSH_SHOW_TRACEBACK = True
$LANG = 'ja_JP.UTF-8'

$COLOR_INPUT = True
$COLOR_RESULTS = True
$INDENT = "    "

# xontrib load powerline2
# xontrib load apt_tabcomplete
# xontrib load z

$PROMPT = (
    "{BOLD_BLUE}{cwd}{RESET} {gitstatus}\n"
    "{env_name}{prompt_end} "
)

$RIGHT_PROMPT = xonsh_py._datetime

if platform.system() == 'Windows':
    $PATH.append('C:\\Python310\\Scripts')
    $PATH.append('~\\tools')
    $PATH.append('~\\go\\bin')
    $PATH.append('~\\my_nvim\\install\\bin')
    $PATH.append('C:\\Program Files\\Git\\usr\\bin')
    $PATH.append('~\\.cargo\\bin')
    aliases['ls']=['lsd.exe']
    aliases['la']=['lsd.exe', '-a']
    aliases['ll']=['lsd.exe', '-al']
else:
    $PATH.append('~/.cargo/bin')
    $PATH.append('~/.local/bin')
    $PATH.append('~/my_nvim/install/bin')
    aliases['ls']='exa --color=auto --icons'
    aliases['la']='exa --color=auto --icons -a'
    aliases['ll']='exa --color=auto --icons -al'


def _repos():
    repository = $(ghq list -p | peco).strip()
    if repository:
        cd @(repository)
aliases['repos'] = _repos

def _start(args, stdin=None, stdout=None, stderr=None, spec=None):
    cmd = ['cmd.exe', '/c', 'start'] + args
    subprocess.run(cmd, stdin=stdin, stdout=stdout, stderr=stderr)
aliases['start'] = _start

def _dotpush(args):
    with xonsh_py.pushdir(HOME_DIR / 'dotfiles'):
        subprocess.run(['git.exe', 'commit', '-av'])
        subprocess.run(['git.exe', 'push'])
aliases['dotpush'] = _dotpush
